# .cybershow.json — Internal Show Format Specification (v3.0)

The `.cybershow.json` file is the **internal lingua franca** of the Cyberstar Simulator. It is the format that:

- SAM (Python) produces after audio analysis
- The manual editor reads and writes
- Playback engine consumes to drive the signal generator
- The export pipeline reads to produce 4-channel WAV / .rshw / .cso

It is a human-readable JSON file and the recommended format for sharing shows between users of the simulator.

---

## Full Schema

```json
{
  "cyberstar_show": true,
  "version": "3.0",
  "title": "Come Together",
  "band": "rock",
  "duration_ms": 256000,
  "duration_frames": 12800,
  "fps": 50,
  "bpm": 84,
  "description": "Auto-generated by SAM v3.0 — 2026-02-15",
  "characters": {
    "<CharacterName>": {
      "signals": [
        {
          "frame": 50,
          "movement": "mouth",
          "state": true,
          "note": ""
        },
        {
          "frame": 53,
          "movement": "mouth",
          "state": false,
          "note": ""
        }
      ]
    }
  }
}
```

---

## Field Definitions

| Field             | Type    | Required | Description                                                 |
| ----------------- | ------- | -------- | ----------------------------------------------------------- |
| `cyberstar_show`  | boolean | Yes      | Always `true`. Acts as a file type marker.                  |
| `version`         | string  | Yes      | Format version. Current: `"3.0"`                            |
| `title`           | string  | Yes      | Human-readable show title                                   |
| `band`            | string  | Yes      | `"rock"` or `"munch"`                                       |
| `duration_ms`     | integer | Yes      | Total show duration in milliseconds                         |
| `duration_frames` | integer | Yes      | Total show duration in frames at `fps` rate                 |
| `fps`             | integer | Yes      | Internal frame rate. Always `50` in v3.0                    |
| `bpm`             | integer | No       | Tempo in beats per minute (from SAM analysis; 0 if unknown) |
| `description`     | string  | No       | Free text description or generation metadata                |
| `characters`      | object  | Yes      | Map of character names to their signal lists                |

### Character Signal Entry

| Field      | Type    | Required | Description                                                   |
| ---------- | ------- | -------- | ------------------------------------------------------------- |
| `frame`    | integer | Yes      | Frame number (0-indexed, at `fps` rate) when this event fires |
| `movement` | string  | Yes      | Movement name — must match a key in `CHARACTER_MOVEMENTS`     |
| `state`    | boolean | Yes      | `true` = actuator on, `false` = actuator off                  |
| `note`     | string  | No       | Optional annotation (auto-gen source, manual note, etc.)      |

---

## Frame Rate Conversion

The internal format uses **50 fps**. The hardware BMC signal runs at **45.9375 fps**. When converting for export:

```
hardware_frame = internal_frame × (45.9375 / 50.0)
```

Or equivalently in milliseconds:

```
time_ms = internal_frame × (1000 / 50)  =  internal_frame × 20ms
hardware_frame = time_ms × 45.9375 / 1000
```

50 fps was chosen because it divides evenly into 1000ms (each frame = exactly 20ms), making arithmetic clean for both manual editing and BPM alignment.

---

## Character Name Rules

Character names in `characters` must exactly match the keys in `CHARACTER_MOVEMENTS`:

- `"Rolfe"` ✓
- `"Dook LaRue"` ✓
- `"rolfe"` ✗ (wrong case)
- `"Duke"` ✗ (wrong name — it's "Dook LaRue")

Movement names similarly must match exactly. The JavaScript console will warn about unknown names during import.

---

## Signals Must Come in Matched Pairs

Every `state: true` signal must have a corresponding `state: false` signal for the same character and movement. An actuator left permanently ON will appear held for the rest of the show. This is usually a bug.

Exception: some prop actuators (curtains, strobe) are intentionally left ON until a scene change.

---

## Versioning

| Version | Changes                                                                                                          |
| ------- | ---------------------------------------------------------------------------------------------------------------- |
| 1.0     | Original format — flat list of events per character                                                              |
| 2.0     | Added `band`, `bpm`, `duration_frames` fields                                                                    |
| 3.0     | Current — added `fps` field, standardised frame-based timing (replaced `time_ms` in signals), added `note` field |

The simulator can import v2.0 files by converting `time_ms` entries to frame numbers on load.
